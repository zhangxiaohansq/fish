function Bullet(type){this.type=type,this.x=0,this.y=0,this.rotate=0,this.iSpeed=2*this.type,this.move()}function Cannon(type){this.type=type,this.x=431,this.y=570,this.cur=0,this.rotate=0,this.timer=null}function Coin(type){this.type=type,this.x=0,this.y=0,this.cur=0,this.move()}function rnd(m,n){return Math.floor(m+Math.random()*(n-m))}function d2a(n){return n*Math.PI/180}function a2d(n){return 180*n/Math.PI}function loadImage(arr,fnSucc){for(var count=0,i=0;i<arr.length;i++){var oImg=new Image;!function(index){oImg.onload=function(){JSON[arr[index]]=this,count++,count==arr.length&&fnSucc&&fnSucc()}}(i),oImg.src="img/"+arr[i]+".png"}}function DieFish(type){this.type=type,this.x=0,this.y=0,this.rotate=0,this.cur=0,this.move()}function Fish(type){this.type=type,this.x=0,this.y=0,this.cur=0,this.rotate=0,this.iSpeed=1,this.collR=FISH_SIZE[this.type].collR,this.move()}function Web(){this.x=0,this.y=0,this.scale=1}var BULLET_SIZE=[null,{x:86,y:0,w:24,h:26},{x:62,y:0,w:25,h:29},{x:30,y:0,w:31,h:35},{x:32,y:35,w:27,h:31},{x:30,y:82,w:29,h:33},{x:0,y:82,w:30,h:34},{x:0,y:0,w:30,h:44}];Bullet.prototype.draw=function(gd){var x=BULLET_SIZE[this.type].x,y=BULLET_SIZE[this.type].y,w=BULLET_SIZE[this.type].w,h=BULLET_SIZE[this.type].h;gd.save(),gd.translate(this.x,this.y),gd.rotate(d2a(this.rotate)),gd.drawImage(JSON.bullet,x,y,w,h,-w/2,-h/2,w,h),gd.restore()},Bullet.prototype.move=function(){var _this=this;setInterval(function(){_this.x+=Math.sin(d2a(_this.rotate))*_this.iSpeed,_this.y-=Math.cos(d2a(_this.rotate))*_this.iSpeed},30)};var CANNON_SIZE=[null,{w:74,h:74},{w:74,h:76},{w:74,h:76},{w:74,h:83},{w:74,h:85},{w:74,h:90},{w:74,h:94}];Cannon.prototype.draw=function(gd){var w=CANNON_SIZE[this.type].w,h=CANNON_SIZE[this.type].h;gd.save(),gd.translate(this.x,this.y),gd.rotate(d2a(this.rotate)),gd.drawImage(JSON["cannon"+this.type],0,this.cur*h,w,h,-w/2,-h/2,w,h),gd.restore()},Cannon.prototype.emitChange=function(){var _this=this;clearInterval(_this.timer),this.timer=setInterval(function(){_this.cur++,5==_this.cur&&(_this.cur=0,clearInterval(_this.timer))},30)},Coin.prototype.draw=function(gd){switch(gd.save(),gd.translate(this.x,this.y),this.type){case 1:case 2:gd.drawImage(JSON.coinAni1,0,60*this.cur,60,60,-30,-30,60,60);break;case 3:case 4:case 5:gd.drawImage(JSON.coinAni2,0,60*this.cur,60,60,-30,-30,60,60)}gd.restore()},Coin.prototype.move=function(){var _this=this;setInterval(function(){_this.x+=(0-_this.x)/10,_this.y+=(650-_this.y)/10,_this.cur++,10==_this.cur&&(_this.cur=0)},30)},Coin.prototype.playSong=function(){var oA=new Audio;oA.src="snd/coin.wav",oA.play()};var JSON={};DieFish.prototype.draw=function(gd){var w=FISH_SIZE[this.type].w,h=FISH_SIZE[this.type].h;gd.save(),gd.translate(this.x,this.y),gd.rotate(d2a(this.rotate)),this.rotate>90&&this.rotate<270&&gd.scale(1,-1),gd.drawImage(JSON["fish"+this.type],0,h*(this.cur+4),w,h,-w/2,-h/2,w,h),gd.restore()},DieFish.prototype.move=function(){var _this=this;setInterval(function(){_this.cur++,4==_this.cur&&(_this.cur=0)},200)};var FISH_SIZE=[null,{w:55,h:37,collR:17},{w:78,h:64,collR:24},{w:72,h:56,collR:20},{w:77,h:59,collR:22},{w:107,h:122,collR:29}];Fish.prototype.draw=function(gd){var w=FISH_SIZE[this.type].w,h=FISH_SIZE[this.type].h;gd.save(),gd.translate(this.x,this.y),gd.rotate(d2a(this.rotate)),this.rotate>90&&this.rotate<270&&gd.scale(1,-1),gd.drawImage(JSON["fish"+this.type],0,h*this.cur,w,h,-w/2,-h/2,w,h),gd.restore()},Fish.prototype.move=function(){var _this=this;setInterval(function(){_this.x+=Math.cos(d2a(_this.rotate))*_this.iSpeed,_this.y+=Math.sin(d2a(_this.rotate))*_this.iSpeed},30),setInterval(function(){_this.cur++,4==_this.cur&&(_this.cur=0)},200)},Fish.prototype.isIn=function(x,y){var a=this.x-x,b=this.y-y,c=Math.sqrt(a*a+b*b);return c<this.collR},document.addEventListener("DOMContentLoaded",function(){var oC=document.getElementById("c1"),gd=oC.getContext("2d"),out=50,direction=[-out,out],rule=.05;loadImage(resource,function(){var arrBullet=[],arrFish=[],arrCoin=[],arrDieFish=[],arrWeb=[],c=new Cannon(4);setInterval(function(){gd.clearRect(0,0,oC.width,oC.height),gd.drawImage(JSON.bottom,0,0,765,70,0,532,765,70),c.draw(gd);for(var i=0;i<arrBullet.length;i++)arrBullet[i].draw(gd);for(var i=0;i<arrBullet.length;i++)(arrBullet[i].x<out||arrBullet[i].x>oC.width+out||arrBullet[i].y<out||arrBullet[i].y>oC.height+out)&&(arrBullet.splice(i,1),i--);if(Math.random()<rule)if(direction.sort(function(){return Math.random()-.5}),direction[0]<0){var f1=new Fish(rnd(1,6));f1.x=0-out,f1.y=rnd(out,oC.height-out),f1.rotate=rnd(-45,45),arrFish.push(f1)}else{var f1=new Fish(rnd(1,6));f1.x=oC.width+out,f1.y=rnd(out,oC.height-out),f1.rotate=rnd(135,225),arrFish.push(f1)}for(var i=0;i<arrFish.length;i++)arrFish[i].draw(gd);for(var i=0;i<arrCoin.length;i++)arrCoin[i].draw(gd);for(var i=0;i<arrDieFish.length;i++)arrDieFish[i].draw(gd);for(var i=0;i<arrWeb.length;i++)arrWeb[i].draw(gd),arrWeb[i].scale+=.01,arrWeb[i].scale>1.2&&(arrWeb.splice(i,1),i--);for(var i=0;i<arrFish.length;i++){(arrFish[i].x<-out||arrFish[i].x>oC.width+out||arrFish[i].y<out||arrFish[i].y>oC.height+out)&&(arrFish.splice(i,1),i--);for(var i=0;i<arrFish.length;i++)for(var j=0;j<arrBullet.length;j++)if(arrFish[i].isIn(arrBullet[j].x,arrBullet[j].y)){var x=arrFish[i].x,y=arrFish[i].y,type=arrFish[i].type,rotate=arrFish[i].rotate;arrFish.splice(i,1),i--,arrBullet.splice(j,1),j--;var coin=new Coin(type);coin.x=x,coin.y=y,coin.playSong(),arrCoin.push(coin);var dieFish=new DieFish(type);dieFish.x=x,dieFish.y=y,dieFish.rotate=rotate,arrDieFish.push(dieFish),setTimeout(function(){arrDieFish.shift()},500);var web=new Web;web.x=x,web.y=y,arrWeb.push(web)}}},30),oC.onclick=function(ev){var oA=new Audio;oA.src="snd/cannon.mp3",oA.play();var x=ev.clientX-oC.offsetLeft-c.x,y=c.y-(ev.clientY-oC.offsetTop),d=90-a2d(Math.atan2(y,x));c.rotate=d,c.emitChange();var bullet=new Bullet(c.type);bullet.x=c.x,bullet.y=c.y,bullet.rotate=c.rotate,arrBullet.push(bullet)}})},!1);var resource=["fish1","fish2","fish3","fish4","fish5","bottom","cannon1","cannon2","cannon3","cannon4","cannon5","cannon6","cannon7","bullet","coinAni1","coinAni2","web"];Web.prototype.draw=function(gd){gd.save(),gd.translate(this.x,this.y),gd.scale(this.scale,this.scale),gd.drawImage(JSON.web,22,22,200,200,-100,-100,200,200),gd.restore()};